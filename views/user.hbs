<div class="container-lg">
  <div class="row my-2">
    {{!-- nav bar --}}
    <div class="col-lg-3 left-sidebar d-flex justify-content-end">
      {{>left-sidebar route='user'}}
    </div>
    {{!-- main content --}}
    <div class="col-lg-6 main-content d-flex flex-column justify-content-center">
      <div class="message">
        {{> messages}}
      </div>
      <div class="outline">
        {{!-- content --}}
        <div class="content">
          {{!-- tittle --}}
          <div class="d-flex">
            <a class="d-flex mt-3 ms-1" onclick="javascript:history.back()">
              <h4 class="navbar-brand mb-0 me-1">←</h4>
            </a>
            <div class="px-0 ms-2 mt-1">
              <p class="fs-5 mb-0 fw-bold">{{user.name}}</p>
              <p class="fs-6 mb-0 text-muted">{{user.Tweets.length}}推文</p>
            </div>
          </div>
          {{!-- user --}}
          <div class="container-fluid d-flex justify-content-center px-0 mt-2">
            <img src="{{user.cover}}" class="user-cover" alt="cover">
          </div>
          {{!-- avatar & button class= "anb-*" --}}
          <div class="d-flex flex-row justify-content-between align-items-end anb-anchor">
            {{!-- avatar --}}
            <div class="mx-3 mb-2">
              <img src="{{user.avatar}}" class="user-avatar" alt="avatar">
            </div>
            {{!-- button --}}
            <div class="mx-4 mb-4">
              {{#ifCond user.id loginUser.id}}
                <button data-bs-toggle="modal" data-bs-target="#exampleModal" class="modal-button fw-bold">編輯個人資料</button>
              {{else}}
                {{#if user.isFollowed}}
                  <form action="/followships/{{user.id}}?_method=DELETE" method="POST" style="display: contents;">
                    <button type="submit" class="user-following-button text-white">正在跟隨</button>
                  </form>
                {{else}}
                  <form action="/followships" method="POST" style="display: contents;">
                    <button type="submit" class="user-follower-button ms-3" name="id" value="{{user.id}}">跟隨</button>
                  </form>
                {{/if}}
              {{/ifCond}}
            </div>
          </div>
          {{!-- user Info --}}
          <div class="user-info ms-2">
            <p class="fw-bold fs-5 mb-0">{{user.name}}</p>
            <p class="fs-6 mb-0 text-muted">@{{user.account}}</p>
            <p class="card-text">{{user.introduction}}</p>
            <p class="card-text">
              <a class="text-decoration-none text-secondary" href='/users/{{user.id}}/followings?type=followings'>
                <small class="following">{{user.followingCount}}個跟隨中</small>
              </a>
              <a class="text-decoration-none text-secondary" href='/users/{{user.id}}/followers?type=followers'>
                <small class="follower ms-3">{{user.followerCount}}位跟隨者</small>
              </a>
            </p>
          </div>
          {{!-- tab --}}
          <div>
            <ul class="nav nav-tabs user-tab-anchor mb-0">
              <li class="nav-item">
                <a class="nav-link fw-bold {{#if tweetsSelect}}active{{/if}}" href="/users/{{user.id}}/tweets?type=tweets">推文</a>
              </li>
              <li class="nav-item">
                <a class="nav-link fw-bold {{#if relpiesSelect}}active{{/if}}" href="/users/{{user.id}}/replies?type=relpies">回覆</a>
              </li>
              <li class="nav-item">
                <a class="nav-link fw-bold {{#if likesSelect}}active{{/if}}" href="/users/{{user.id}}/likes?type=likes">喜歡的內容</a>
              </li>
            </ul>
          </div>          
          {{!-- user content --}}
          <div class="tab-content">
            {{#if tweetsSelect}}
              {{#each user.Tweets}}
                {{> user-tweets}}
              {{/each}}
            {{/if}}
            {{!-- replies --}}
            {{#if relpiesSelect}}
              {{#each user.Replies}}
                {{> user-replies}}
              {{/each}}
            {{/if}}
            {{!-- likes --}}
            {{#if likesSelect}}
              {{#each user.Likes}}
                {{> user-likes}}
              {{/each}}
            {{/if}}
          </div>
        </div>
      </div>
    </div>
    {{!-- nav bar --}}
    <div class="col-lg-3 right-sidebar">
      {{> right-sidebar}}
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content user-edit-modal">
      {{!-- edit form --}}
      <form action="/users/{{user.id}}?_method=PUT" method="POST" enctype="multipart/form-data">
        {{!-- modal header --}}
        <div class="modal-header mt-1 p-2">
          <div class="col-4 d-flex justify-content-between">
            <button type="button" class="btn-close ms-0 mt-0 pt-0" data-bs-dismiss="modal" aria-label="Close"></button>
            <h5 class="modal-title fw-bold" id="exampleModalLabel">編輯個人資料</h5>
          </div>
          <div class="col-8 d-flex justify-content-end">
            <button type="submit" class="btn save-btn">儲存</button>
          </div>
        </div>
        {{!-- modal body --}}
        <div class="modal-body p-0">
          {{!-- cover --}}
          <div class="form-row mb-3 mx-auto" style="position: relative;">
            <img src="{{user.cover}}" alt="cover">
            <label for="cover" class="btn cover-uploader cover-upload-icon">
              <input class="d-none" type="file" id="cover" name="cover">
              <i class="user-cover fa-solid fa-camera"></i>
            </label>
          </div>
          {{!-- avatar --}}
          <div class="d-flex flex-row justify-content-between align-items-end edit-avatar-anchor">
            <label for="avatar" class="btn cover-uploader">
              <img src="{{user.avatar}}" class="user-avatar" alt="avatar">
              <input class="d-none" type="file" id="avatar" name="avatar">
              <i class="fa-solid fa-camera avatar-camera-anchor"></i>
            </label>
          </div>
          {{!-- user name --}}
          <div class="form-row mt-5 p-2 edit-name-anchor">
            <label class="form-label fw-bold" for="name">名稱</label>
            <input class="form-control" type="text" name="name" id="name" placeholder="Enter name" value="{{user.name}}"
              required>
            <p class="text-end text-muted now1 mb-0" style="font-size: 0.98em;">{{user.name.length}}/50</p>
          </div>
          {{!-- user intro --}}
          <div class="form-row mb-3 p-2 edit-intro-anchor">
            <label class="form-label fw-bold" for="introduction">自我介紹</label>
            <textarea class="form-control" id="introduction" name="introduction" rows="4"
              required>{{user.introduction}}</textarea>
            <p class="text-end text-muted now1" style="font-size: 0.98em;">{{user.introduction.length}}/160</p>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>