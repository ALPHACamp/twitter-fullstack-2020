<div class="container d-flex flex-column align-items-center">

  <div class="card" style="width: 38rem;">

    <div class="d-flex align-items-center">
      <a href="/" class="btn">
        <i class="fas fa-arrow-left"></i>
      </a>
      <div class="d-flex flex-column ms-4">
        <h5 class="mb-0 mt-2 fontWeight900">{{user.name}}</h5>
        <p class="mt-0 mb-2" style="color:#657786;">{{totalTweet}} 推文</p>
      </div>
    </div>

    <img src="{{user.cover}}" style="position:relate; height: 200px" class="" alt="...">
    <img src="{{user.avatar}}" class="rounded-circle user-avatar" alt="...">

    <div class="d-flex flex-row-reverse m-2">
      <button type="button" class="btn btn-orange-white rounded-pill" data-bs-toggle="modal" data-bs-target="#userModal"
        data-bs-whatever="@getbootstrap">編輯個人資料</button>
    </div>


    <div class="card-body">
      <h5 class="card-title fontWeight900">{{user.name}}</h5>
      <h6 style="color:#657786;">@{{user.account}}</h6>
      <p class="card-text">{{user.introduction}}</p>
    </div>

    <div class="d-flex mx-3">
      <a href="/users/self/following/{{user.id}}" class="btn ps-0">
        <span class="fontWeight500">{{followerCount}}個</span><span style="color:#657786;">跟隨中</span>
      </a>
      <a href="/users/self/follower/{{user.id}}" class="btn">
        <span class="fontWeight500">{{followingCount}}位</span><span style="color:#657786;">跟隨者</span>
      </a>
    </div>

    <ul class="nav nav-tabs mt-4">
      <li class="nav-item">
        <a class="nav-link fontWeight700 active" href="#">推文</a>
      </li>
      <li class="nav-item">
        <a class="nav-link fontWeight700" href="/users/self/reply/{{user.id}}">推文與回覆</a>
      </li>
      <li class="nav-item">
        <a class="nav-link fontWeight700" href="/users/self/like/{{user.id}}">喜歡的內容</a>
      </li>
    </ul>


    {{#each tweet}}
    <div class="card p-3">
      <div class="d-flex">
        <div>
          <a href="/users/self/{{../user.id}}" style="text-decoration: none;">
            <img src="{{../user.avatar}}" style="width: 3rem; height: 3rem;" class="rounded-circle me-3" alt="...">
          </a>
        </div>
        <div class="col-md-8">
          <div class="userInfo d-flex">
            <a href="/users/self/{{../user.id}}" style="text-decoration: none; color:black;">
              <h6 class="fontWeight700 me-2">{{../user.name}}</h6>
            </a>
            <a href="/users/self/{{../user.id}}" style="text-decoration: none;">
              <h6 class="fontWeight500" style="color:#657786;">@{{../user.account}}</h6>
            </a>
            <h6 class="fontWeight500" style="color:#657786;">‧{{moment this.createdAt}}</h6>
          </div>
          <p class="card-text fontWeight500">{{this.description}}</p>

          <div class="d-flex align-items-center">
            {{#if this.isLiked }}
            <form action="/tweets/{{ this.id }}/unlike?_method=DELETE" method="POST">
              <button type="submit" class="btn" style="color: #657786">
                <i class="fas fa-heart me-3"></i><span class="fontWeight500 me-5">{{this.likeCount}}</span>
              </button>
            </form>
            {{else}}
            <form action="/tweets/{{ this.id }}/like" method="POST">
              <button type="submit" class="btn" style="color: #657786">
                <i class="far fa-heart me-3"></i><span class="fontWeight500 me-5">{{this.likeCount}}</span>
              </button>
            </form>
            {{/if}}
            <a href="/tweets/{{this.id}}/replyList" style="text-decoration: none; color: 
          #657786"><i class="far fa-comment me-3"></i><span class="fontWeight500">{{this.replyCount}}</span></a>
          </div>
        </div>
      </div>
    </div>
    {{/each}}
  </div>
</div>


<!-- Profile Modal -->
<div class="modal fade" id="userModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form action="/users/self/edit/{{user.id}}?_method=PUT" method="POST" enctype="multipart/form-data">
      <div class="modal-content" style="width: 598px;">
        <div class="modal-header">
          <div class="d-flex align-items-center">
            <i class="fas fa-times modal-close" data-bs-dismiss="modal" aria-label="Close"></i>
            <h5 class="modal-title ms-5 fontWeight700" id="exampleModalLabel">編輯個人資料</h5>
          </div>
          <button type="submit" class="btn btn-white-orange rounded-pill" style="width: 66px;">儲存</button>
        </div>


        <div class="">
          <div class="mb-3">
            <img src="{{user.cover}}" class="mx-0 px-0" style="width: 596px; height: 200px; position:relate;" alt="...">
            <label for="modal_cover">
              <input type="file" id="modal_cover" name="cover" style="display: none;">
              <i class="fas fa-camera cover-camera"></i>
            </label>
            <i class="fas fa-times cover-close"></i>
            <img src="{{user.avatar}}" class="rounded-circle user-avatar-modal" alt="...">
            <label for="modal_avatar">
              <input type="file" id="modal_avatar" name="avatar" style="display: none;">
              <i class="fas fa-camera avatar-camera"></i>
            </label>
          </div>
          <div class="mx-3" style="background-color: #F5F8FA; margin-top: 5rem;">
            <label for="userName" class="col-form-label fontWeight500 ms-3" style="color:#657786;">名稱</label>
            <input type="text" class="form-control editInput ms-1" id="userName" name="name" maxlength="50"
              onkeyup="nameWordCount()" value="{{user.name}}">
          </div>
          <div class="d-flex justify-content-end mt-0 mb-3 me-3">
            <span class="fontWeight500" style="color:#657786;" id="nameWordCount">{{nameWordCount}}/50</span>
          </div>
          <div class="mx-3" style="background-color: #F5F8FA;">
            <label for="introText" class="col-form-label fontWeight500 ms-3" style="color:#657786;">自我介紹</label>
            <textarea class="form-control editInput ms-3" id="introText" name="introduction" maxlength="160"
              onkeyup="introWordCount()">{{user.introduction}}</textarea>
          </div>
          <div class="d-flex justify-content-end mt-0 mb-3 me-3">
            <span class="fontWeight500" style="color:#657786;" id="introWordCount">{{introWordCount}}/160</span>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>

<script>

  function nameWordCount() {
    const wordCounts = document.getElementById('userName').value.length
    document.getElementById('nameWordCount').innerHTML = `${wordCounts}/50`
  }

  function introWordCount() {
    const wordCounts = document.getElementById('introText').value.length
    document.getElementById('introWordCount').innerHTML = `${wordCounts}/160`
  }
  })

</script>